# Ferret Tickets
#### A simple Python Flask Ticketing System written for University (Software Engineering & Agile)

----
## Getting started

Before running the application for production or development please read through the [config](#config) section of this readme and update `app/config.ini` to your required settings

**The default username and password for the superuser are public, please change them before exposing the application externally**

### Production
Production deployment of the app is configured to work using a docker image. shell scripts have been provided to automatically build and deploy the image in a container, please ensure you have [docker](https://www.docker.com/) installed before proceeding

**Please ensure you have changed the default username and password for the Superuser before exposing the application externally**

First, provide the build and run scripts execution permission by running
```shell
sudo chmod 775 build-image.sh start-production.sh
```

Then to build the image please run
```shell
./build-image.sh
```

once built you can deploy the container with
```shell
./start-production.sh
```

This will deploy the container on port 80, running the application in production mode.

### Development

The application exists within the `app/` folder

In order to keep your environment clean, run:
```shell
python -m venv .pyenv
. .pyenv/bin/activate
```

This project contains PyPi requirements which can be found in `app/requirements.txt`
to install these requirements simply run:

```shell
pip install -r app/requirements.txt
```

Once complete, the app can be run with

```shell
python3.11 -m app
```

This will start the flask application on port 5000, running the application in development mode.

----
## Invite Codes

To create an account on the system an invitation code is required, a code can be generated by a user with sufficient [permissions](#permissions)

When a new user registers they will be assigned the `default` UserGroup, please ensure you are happy with the default permissions in this group.

If unchanged in the [config](#config) three invite codes will be generated by the system when a new database is created

----
## Permissions
The system uses a UserGroup based permission system, by default, two UserGroups are created on the system, the system depends on these UserGroups, and they therefore cannot be deleted and, supergroup cannot be updated. If unchanged their permissions are as follows:

#### `supergroup` which has Permissions:
- `ADMIN`

#### `default` which has Permissions:
- `READ_TICKETS`
- `CREATE_TICKETS`
- `UPDATE_TICKETS`
- `RESOLVE_OWN_TICKETS`

The default group is assigned to all new users registering to the system.

The default permissions for these groups can be changed within `app/config.ini`

If you would like to create additional UserGroups on initial system setup (New Database) please add these to `app/permissionsHandler/default_groups.json`

`default_groups.json` Example:
```json
{
  "groups": [
    {
      "name": "example_group_one",
      "permissions": "TICKETS,READ_CODES"
    },
    {
      "name": "example_group_two",
      "permissions": "ADMIN"
    }
  ]
}
```

You can assign both specific permissions and permission categories to a UserGroup. If a permission category is selected, the UserGroup will gain all specific permissions inside that category.
### Available Permissions
- `ADMIN` - If a group has this permission all permission checks are bypassed and the user is allowed to perform the action. **Warning: This is a dangerous permission to assign**

#### Tickets Permissions
- `TICKETS` - All Ticket Permissions
- `READ_TICKETS` - View all tickets
- `CREATE_TICKETS` - Create new tickets
- `UPDATE_TICKETS` - Update/Change existing tickets
- `DELETE_TICKETS` - Delete existing tickets
- `RESOLVE_OWN_TICKETS` - Change the status of tickets created by the user
- `RESOLVE_OTHERS_TICKETS` - Change the status of all tickets

#### Invite Codes Permissions
- `INVITECODES` - All Invite Code Permissions
- `READ_CODES` - View all Invite Codes
- `CREATE_CODES` - Create new Invite Codes
- `REVOKE_CODES` - Revoke existing Invite Codes

#### User Account Permissions
- `USERACCOUNTS` - All User Account Permissions
- `READ_USERS` - View all system user accounts
- `UPDATE_USERS` - Update/Change existing user accounts
- `DELETE_USERS` - Delete user accounts

#### UserGroup Permissions
- `USERGROUPS` - All UserGroup Permissions
- `READ_USERGROUPS` - View all system UserGroups
- `CREATE_USERGROUPS` - Create new UserGroups
- `UPDATE_USERGROUPS` - Update/Change existing UserGroups
- `DELETE_USERGROUPS` - Delete existing UserGroups

----
## Config

The config file can be found at `app/config.ini`

Please note that some configuration items in the config can only be changed before initial system setup (New Database)

**Changing certain config items after system setup will cause errors**

Config items that may break the application if changed without a new database will be marked above the entry with `;ONLY CHANGE IF NEW DATABASE`

**Changing certain config items after system setup may not take effect without a new database**

Config items that take no effect if changed without a new database will be marked above the entry with `;NO EFFECT WITHOUT NEW DATABASE`

To change these config items please delete the existing database before running the application again.

### [development_webserver]
Settings for the development (Non-WSGI) webserver
- `port` - The port the webserver will be hosted on (Default: `5000`)
- `host_address` - The address the webserver will bind to (Default: `127.0.0.1`)
- `debug_mode` - Puts flask into debug mode, allowing for more detailed error readouts and traceback (Default: `true`)
- `use_reloader` - **NOT RECCOMENDED TO ENABLE** - Uses flasks reloader during development to restart the webserver whenever a change is made to the source (Default: `false`)

### [logger]
Settings for the logger function, allows for configuration of level of logging and the name the system logger uses
- `logger_name` - The primary name the application will use for logging, modules will use the format `<logger_name>.<module_title>` (Default: `FerretTickets`)
- `logger_level` - The required level of log before the logger will output to console, Lower Value = More Verbose (Default: `1`)
  - `0` NOTSET All logs will be produced
  - `1` DEBUG all logs above and including DEBUG will be produced
  - `2` INFO all logs above and including INFO will be produced
  - `3` WARNING all logs above and including WARNING will be produced
  - `4` ERROR all logs above and including ERROR will be produced
  - `5` CRITICAL all logs above and including CRITICAL will be produced

### [database]
Settings for the database, allows for configuration of database storage path
- `path` - Defines where SQLite3 database file will be stored, if set to `default` the app will use `<Current Working Directory>/database/` (Default: `default`)

### [system_groups]
Settings for the system dependant UserGroups, allows for configuration of group names and default group permissions.
- `supergroup_name` - The assigned name for the default administrator UserGroup (Default: `supergroup`)
  - **ONLY CHANGE IF NEW DATABASE**
- `default_name` - The assigned name for the default UserGroup (Default: `default`)
  - **ONLY CHANGE IF NEW DATABASE**
- `default_permissions` - The permissions assigned to the default group when system is setup (Default: `READ_TICKETS,CREATE_TICKETS,UPDATE_TICKETS,RESOLVE_OWN_TICKETS`)
  - NO EFFECT WITHOUT NEW DATABASE


### [superuser]
Settings for the superuser, or default user when the system is initially created, allows for changing of default username/password
- `username` - Username for the default administrator on the system (Default: `Administrator`)
  - **ONLY CHANGE IF NEW DATABASE**
- `password` - Password for the default administrator on the system (Default: `PleaseChangeThisDefaultPassword`)
  - NO EFFECT WITHOUT NEW DATABASE

### [demo_mode]
Settings for demo mode, if enabled the system will generate fake data so that the system functionality can be demonstrated
- `create_demo_data` - If set to true, dummy data will be placed into the database when created to demonstrate system use (Default: `false`)
  - NO EFFECT WITHOUT NEW DATABASE

### [invite_codes]
Settings for invite codes, allows for configuration on how many are created when system is setup and custom prefix for codes
- `initial_creation` - How many invite codes to generate when the database is first created (Default `3`)
  - NO EFFECT WITHOUT NEW DATABASE
- `code_prefix` - A prefix added to invite codes when created (Default: `FerretTickets`)

----
### Credits and Thank You's

#### Thank You's
- [Anoyomouse](https://github.com/Anoyomouse) - For helping me get docker working properly!

#### Credits
- The Flask Team - Flask - [Flask Website](https://flask.palletsprojects.com/en/3.0.x/)
- The Django Team - Django - [Django Website](https://www.djangoproject.com/)
- Jeff Ferland - IPy - [IPy PyPi](https://pypi.org/project/IPy/)
- WTForms Team - WTForms - [WTForms Github](https://github.com/wtforms/wtforms)
- PyPika Team - PyPika - [PyPika Github](https://github.com/kayak/pypika)
- Stavros Korokithakis - shortuuid - [shortuuid PyPi](https://pypi.org/project/shortuuid/)
- The Bootstrap-Flask Team - Bootstrap-Flask - [Bootstrap-Flask PyPi](https://pypi.org/project/Bootstrap-Flask/)
- Docker Inc - Docker - [Docker Website](https://www.docker.com/)
- Tiangolo - uwsgi-nginx-flask Docker Image - [uwsgi-nginx-flask Dockerhub](https://hub.docker.com/r/tiangolo/uwsgi-nginx-flask)

#### Attributions
- [Ferret icons created by Freepik - Flaticon](https://www.flaticon.com/free-icons/ferret)
